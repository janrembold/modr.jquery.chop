/*! modr.jquery.chop | @version v0.2.0 | @license MIT */
!function(e){"use strict";var a={plugin:"chop",module:"url",defaults:{active:!0,urlencode:!1,onDeparam:null}};modr.registerModule(a,{prepare:function(){var e=this,a=e.$element.data("param");e.options.active&&a&&""!==a&&e.historyAvailable()&&(e.param=a,e.init())},init:function(){var e=this;e.$items=e.$element.find(".chop__item"),e.$element.one("open.items.chop",function(a,t){a.stopImmediatePropagation();var i=e.deparam();"undefined"!=typeof i[e.param]&&(a.preventDefault(),e.normalizeParams(i),t.openItems=i[e.param])}),e.$element.one("ready."+a.plugin,function(){e.initListeners()})},initListeners:function(){var e=this;e.$items.on("after.open.item.chop",function(){clearInterval(e.timeout),e.set(e.$items.index(this))}),e.$items.on("after.close.item.chop",function(){var a=e.$items.index(this);clearInterval(e.timeout),e.timeout=setTimeout(function(){e.remove(a)},250)})},set:function(a){var t=this,i=t.deparam();t.normalizeParams(i),-1===e.inArray(a,i[t.param])&&(i[t.param].push(a),t.replace(i))},remove:function(a){var t=this,i=t.deparam();t.normalizeParams(i);var n=e.inArray(a,i[t.param]);n>-1&&(i[t.param].splice(n,1),t.replace(i))},replace:function(a){var t=this,i=e.param(a,!0);t.options.urlencode&&(i=urlencode(i)),i=""===i?window.location.pathname:"?"+i,i+=window.location.hash,window.history.replaceState({},document.title,i)},deparam:function(){var a=this;if(e.isFunction(a.options.onDeparam))return a.options.onDeparam();for(var t=window.location.search.substring(1),i=t.split("&"),n={},r=0,o=i.length;o>r;++r)if(i[r]&&""!==i[r]){var s=i[r].split("=");"undefined"==typeof n[s[0]]?n[s[0]]=s[1]:(e.isArray(n[s[0]])||(n[s[0]]=[n[s[0]]]),n[s[0]].push(s[1]))}return n},normalizeParams:function(a){var t=this;if("undefined"==typeof a[t.param])a[t.param]=[];else{e.isArray(a[t.param])||(a[t.param]=[a[t.param]]);for(var i=0,n=a[t.param].length;n>i;++i)a[t.param][i]=parseInt(a[t.param][i])}},historyAvailable:function(){var e=navigator.userAgent;return-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone")?window.history&&"pushState"in window.history:!1},destroy:function(){var e=this;clearInterval(e.timeout),e.$items.off("after.open.accordion.chop after.close.accordion.chop after.open.tab.chop"),delete e.param,delete e.$items,delete e.timeout}})}(jQuery);